#!/usr/bin/env bash

# Kali Linux Environment - Cyberpunk Japanese Theme
# Script del menÃº de power con estilo Cyberpunk

# ConfiguraciÃ³n de colores
bg="#0A0A0A"
bg-alt="#1A1A1A"
fg="#FF0033"
fg-alt="#FF0044"

# ConfiguraciÃ³n de Rofi
rofi_command="rofi -theme ~/.config/polybar/scripts/style-3.rasi"

# Opciones del menÃº
shutdown="â»  Apagar"
reboot="ðŸ”„  Reiniciar"
lock="ðŸ”’  Bloquear"
suspend="ðŸ’¤  Suspender"
logout="ðŸšª  Cerrar SesiÃ³n"
cancel="âŒ  Cancelar"

# FunciÃ³n para mostrar el menÃº
show_menu() {
    echo -e "$shutdown\n$reboot\n$lock\n$suspend\n$logout\n$cancel" | $rofi_command -dmenu -selected-row 2
}

# FunciÃ³n para confirmar acciÃ³n
confirm_action() {
    local action="$1"
    local message="$2"
    
    echo -e "âœ…  SÃ­\nâŒ  No" | $rofi_command -dmenu -mesg "$message" -selected-row 0
}

# FunciÃ³n principal
main() {
    # Mostrar menÃº principal
    chosen="$(show_menu)"
    
    case $chosen in
        $shutdown)
            # Confirmar apagado
            confirm=$(confirm_action "shutdown" "Â¿EstÃ¡s seguro de que quieres apagar el sistema?")
            if [[ $confirm == "âœ…  SÃ­" ]]; then
                systemctl poweroff
            fi
            ;;
        $reboot)
            # Confirmar reinicio
            confirm=$(confirm_action "reboot" "Â¿EstÃ¡s seguro de que quieres reiniciar el sistema?")
            if [[ $confirm == "âœ…  SÃ­" ]]; then
                systemctl reboot
            fi
            ;;
        $lock)
            # Bloquear pantalla
            if command -v i3lock &> /dev/null; then
                i3lock -i ~/.config/wallpapers/cyberpunk-lock.png
            elif command -v slock &> /dev/null; then
                slock
            else
                xset s activate
            fi
            ;;
        $suspend)
            # Suspender sistema
            confirm=$(confirm_action "suspend" "Â¿EstÃ¡s seguro de que quieres suspender el sistema?")
            if [[ $confirm == "âœ…  SÃ­" ]]; then
                systemctl suspend
            fi
            ;;
        $logout)
            # Cerrar sesiÃ³n
            confirm=$(confirm_action "logout" "Â¿EstÃ¡s seguro de que quieres cerrar la sesiÃ³n?")
            if [[ $confirm == "âœ…  SÃ­" ]]; then
                if [[ $XDG_SESSION_TYPE == "x11" ]]; then
                    pkill -u $USER
                else
                    loginctl terminate-user $USER
                fi
            fi
            ;;
        $cancel)
            # Cancelar acciÃ³n
            exit 0
            ;;
        *)
            # OpciÃ³n no vÃ¡lida
            exit 1
            ;;
    esac
}

# Ejecutar funciÃ³n principal
main "$@"